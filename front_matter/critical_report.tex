\documentclass[parskip=full]{scrreprt}

\setcounter{secnumdepth}{-1}
\RedeclareSectionCommand[pagestyle=plain,afterskip=10pt plus 1pt]{chapter}
\RedeclareSectionCommand[afterskip=0pt plus 1pt,runin=false]{section}
\RedeclareSectionCommand[beforeskip=0pt,afterskip=0pt]{subsection}
\setkomafont{chapter}{\mdseries\headingfont\fontsize{40}{40}\selectfont\color{black!80}}
\setkomafont{section}{\normalfont\sbseries\large}
\setkomafont{subsection}{\normalfont\itshape}
\setkomafont{pageheadfoot}{\normalsize}

\def\pnumbox#1{#1\hspace*{8cm}}
\def\gobble#1{}
\DeclareTOCStyleEntry[
  indent=0pt,
  beforeskip=0pt,
  entryformat=\itshape,
  entrynumberformat=\textcolor{oldred},
  numwidth=2em,
  linefill=\hfill,
  pagenumberbox=\pnumbox,
  pagenumberformat=\itshape
]{tocline}{part}

\DeclareTOCStyleEntry[
  indent=0pt,
  beforeskip=0pt,
  entrynumberformat=\textcolor{oldred},
  numwidth=2em,
  linefill=\hfill,
  pagenumberbox=\pnumbox
]{tocline}{section}

\DeclareTOCStyleEntry[
  indent=0pt,
  beforeskip=-\parskip,
  entrynumberformat=\gobble,
  entryformat=\ltseries,
  numwidth=2em,
  linefill=\hfill,
  pagenumberbox=\pnumbox,
  pagenumberformat=\ltseries
]{tocline}{subsection}


\usepackage{polyglossia}
\setdefaultlanguage{english}


\usepackage{fontspec}
\setmainfont{Source Sans Pro}[
  ItalicFont = Source Sans Pro Italic,
  BoldFont = Source Sans Pro Bold,
  BoldItalicFont = Source Sans Pro Bold Italic,
  FontFace = {lt}{n}{Source Sans Pro Light},
  FontFace = {lt}{it}{Source Sans Pro Light Italic},
  FontFace = {sb}{n}{Source Sans Pro Semibold},
  FontFace = {sb}{it}{Source Sans Pro Semibold Italic},
  Numbers = Proportional,
  Ligatures = Common
]
\DeclareRobustCommand{\ltseries}{\fontseries{lt}\selectfont}
\DeclareRobustCommand{\sbseries}{\fontseries{sb}\selectfont}
\DeclareTextFontCommand{\textlt}{\ltseries}
\DeclareTextFontCommand{\textsb}{\sbseries}
\newfontfamily\headingfont{Fredericka the Great}
\newfontfamily\fontawesome{FontAwesome}


\usepackage[pass]{geometry}
\newgeometry{twoside,inner=20mm,outer=40mm,top=20mm,bottom=40mm}


\usepackage[hyphens]{url}
\urlstyle{same}


\usepackage{microtype}
\microtypesetup{verbose=silent}


\usepackage{booktabs,array,longtable}
\newcolumntype{L}[1]{%
  >{\raggedright\let\newline\\\arraybackslash\hspace{0pt}}p{#1}%
}


\usepackage{graphicx}


\usepackage{xcolor}
\definecolor{oldred}{rgb}{.8313,0,0}


\usepackage{pdfpages}


\usepackage{scrlayer-scrpage}
\pagestyle{scrheadings}
\clearscrheadfoot
\cfoot[\thepage]{\thepage}
\pagenumbering{roman}


\usepackage{enumitem}
\setlist[description]{%
  style=nextline,%
  leftmargin=2em,%
  first=\ltseries,%
  font=\normalfont%
}
\def\lyrefitem#1{\item[\lyref{#1}]}


\usepackage[cacheDir=/tmp/latex-markdown,smartEllipses]{markdown}


\usepackage{datetime2}
\DTMsetstyle{iso}


\makeatletter

\def\@firstofthree#1#2#3{#1}
\def\@secondofthree#1#2#3{#2}
\def\@thirdofthree#1#2#3{#3}
\def\@firstoffour#1#2#3#4{#1}
\def\@secondoffour#1#2#3#4{#2}
\def\@thirdoffour#1#2#3#4{#3}
\def\@fourthoffour#1#2#3#4{#4}
\def\Dotfill{\leavevmode\cleaders\hb@xt@ .75em{\hss .\hss }\hfill \kern \z@}

\def\lyrefnumber#1{\expandafter\@setref\csname r@#1\endcsname\@firstofthree{#1}}
\def\lyreftitle#1{\expandafter\@setref\csname r@#1\endcsname\@secondofthree{#1}}
\def\lyrefpage#1{\expandafter\@setref\csname r@#1\endcsname\@thirdofthree{#1}}

\def\lyrefgenrenumber#1{\expandafter\@setref\csname r@#1\endcsname\@firstoffour{#1}}
\def\lyrefgenregenre#1{\expandafter\@setref\csname r@#1\endcsname\@secondoffour{#1}}
\def\lyrefgenretitle#1{\expandafter\@setref\csname r@#1\endcsname\@thirdoffour{#1}}
\def\lyrefgenrepage#1{\expandafter\@setref\csname r@#1\endcsname\@fourthoffour{#1}}

\def\lyref#1{%
  \begingroup%
  \makebox[0pt][l]{\color{oldred}\lyrefnumber{#1}}\hspace*{2em}%
  \lyreftitle{#1}\Dotfill\lyrefpage{#1}%
  \endgroup%
}
\def\lyrefpart#1{%
  \begingroup%
  \makebox[0pt][l]{\sbseries\color{oldred}\lyrefnumber{#1}}\hspace*{2em}%
  \makebox[0pt][l]{\sbseries\lyreftitle{#1}}\hspace*{6.5em}%
  \hfill\sbseries\lyrefpage{#1}%
  \endgroup%
}
\def\lyrefsection#1{%
  \begingroup%
  \makebox[0pt][l]{\color{oldred}\lyrefgenrenumber{#1}}\hspace*{2em}%
  \makebox[0pt][l]{\ltseries\lyrefgenregenre{#1}}\hspace*{6.5em}%
  \lyrefgenretitle{#1}\Dotfill\lyrefgenrepage{#1}%
  \endgroup%
}
\InputIfFileExists{../tmp/lilypond.ref}{}{\InputIfFileExists{../lilypond.ref}{}{}}


\newcommand\fancytitlehead{
  \headingfont%
  \fontsize{80}{80}\selectfont%
  \textcolor{black!80}{%
    \makebox[0pt][l]{\@ifundefined{@shortname}{\@lastname}{\@shortname}.}%
  }\\[15pt]%
  \fontsize{60}{60}\selectfont%
  \makebox[0pt][l]{\@ifundefined{@shorttitle}{\@title}{\@shorttitle}.}%
}


\def\firstname#1{\def\@firstname{#1}}
\def\lastname#1{\def\@lastname{#1}}
\def\shortname#1{\def\@shortname{#1}}
\def\shorttitle#1{\def\@shorttitle{#1}}
\def\namesuffix#1{\def\@namesuffix{#1}}
\def\scoring#1{\def\@scoring{#1}}
\def\parts#1{\def\@parts{#1}}
\def\repository#1{\def\userepository{{\fontawesome}~#1}}
\def\version#1{\def\useversion{#1}}
\def\date#1{\DTMsavedate{compiled}{#1}}

\firstname{\relax}
\lastname{\relax}
\namesuffix{\relax}
\scoring{\relax}
\parts{\relax}
\repository{\relax}
\version{\relax}
\date{2021-01-01}


\def\maketitle{%
\begin{titlepage}%
  \Large%
  {\@titlehead}%
  \vfill%
  {\strut\@firstname}\\%
  {\sbseries\color{oldred}\strut\@lastname}\\%
  {\strut\@namesuffix}%
  \vfill%
  {\sbseries\@title}\\%
  {\@subtitle}\\[\baselineskip]%
  {\itshape\@scoring}%
  \vfill%
  {\itshape\@parts}\hspace*{\fill}\raisebox{0pt}[0pt][0pt]{\includegraphics[scale=1.25]{logo_full}}%
\end{titlepage}%
}


\newif\iftemplate\templatetrue
\newif\ifprintreport\printreportfalse
\directlua{
scores = {
  ottoni = "Clarino I, II in B\string\\newline Timpani in B–F",
  vl1 = "Violino I",
  vl2 = "Violino II",
  vla1 = "Viola I",
  vla2 = "Viola II",
  coro = "Coro",
  org = "Organo",
  b = "Bassi",
  full_score = "Full Score"
}

last_arg = arg[\string#arg]
texio.write("Last argument: " .. last_arg)
if not (scores[last_arg] == nil) then
  tex.print("\string\\def\string\\lypdfname{" .. last_arg .. "}")
  tex.print("\string\\parts{" .. scores[last_arg] .. "}")
  if (last_arg == "full_score") then
    tex.print("\string\\printreporttrue")
  end
end
}

\@ifundefined{lypdfname}{%
  \templatefalse
  \printreporttrue
  \parts{Draft}
}{\templatetrue}

\makeatother



\begin{document}
\frenchspacing

\titlehead{\fancytitlehead}
\firstname{Leopold}
\lastname{Hofmann}
\title{Lytaniae de la Madona in B}
\shorttitle{Lytaniae}
\subtitle{(A-Ed G 112)}
\scoring{S, A, T, B (solo), S, A, T, B (coro), 2 clno (B), timp (B–F), 2 vl, 2 vla, b, org}
\repository{edition-esser-skala/hofmann-lytaniae-in-B}
\version{1.1.0}
\date{2021-11-04}
\maketitle


\thispagestyle{empty}

\vspace*{\fill}

\raisebox{-4mm}{\includegraphics{byncsaeu}}\hspace*{1em}Wolfgang Esser-Skala, 2021

© 2021 by Wolfgang Esser-Skala. This edition is licensed under the Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License. To view a copy of this license, visit \url{http://creativecommons.org/licenses/by-nc-sa/4.0/}.

Music engraving by LilyPond 2.22.0 (\url{http://www.lilypond.org}).\\
Front matter typeset with Source Sans Pro and Fredericka the Great.

\userepository\\
\textit{v\useversion, \DTMusedate{compiled}}

\vspace*{2cm}

\ifprintreport
\chapter*{Critical Report}

This edition bases upon a copy in the Dommusikarchiv Eisenstadt. The digital version of the manuscript is available at \url{http://dommusikarchiv.martinus.at/site/werkverzeichnis/gallery/293.html} (siglum G 112; see also RISM ID 600038340).

In general, this edition closely follows the manuscript. Any changes that were introduced by the editor are indicated by italic type (lyrics, dynamics and directions), parentheses (expressive marks and bass figures) or dashes (slurs and ties). Accidentals are used according to modern conventions. Asterisks denote changes that are clarified in the detailed remarks below.\footnote{Abbreviations: A, alto; B, basso; b, basses; clno, clarion; Ms, manuscript; org, organ; r, rest; S, soprano; T, tenor; timp, timpani; vl, violin; vla, viola.}

\bigskip

\begin{longtable}{lll L{10cm}}
  \toprule
  \itshape Mov. & \itshape Bar & \itshape Staff & \itshape Note \\
  \midrule \endhead
  1 & 4   & vl 2   & 1st eighth in Ms: d″8 \\
  4 & 14  & S      & 4th quarter in Ms: des″8–c″8 \\
    & 16  & vl 1   & 6th sixteenth in Ms: g′16 \\
  6 & –   & vl     & vl 2 as shown has been later inserted into the vl 2 part of the Ms. The original voice was mostly identical to vl 1, except for bars 9 (2nd quarter), 20 (2nd quarter), 27 (last quarter), and 37 (last note) to 39 (last note), where it was equal to the shown voice. \\
    & 9   & vl 1   & 3rd quarter in Ms: es′4 \\
    & 20  & vl 1   & 3rd quarter in Ms: c′4 \\
    & 28  & vl 1   & 1st quarter in Ms: f′4 \\
    & 38  & S, A   & grace note missing in Ms \\
  7 & 1f  & T      & last eight of bar 1: d′8; first half of bar 2: d′8.–c′16–c′4 \\
    & 12  & S      & grace note missing in Ms \\
  \bottomrule
\end{longtable}


This edition has been compiled and checked with utmost diligence. Nevertheless, errors and mistakes cannot be totally excluded. Please report any errors and mistakes to \url{edition@esser-skala.at} or create an issue or pull request in the edition’s GitHub repository \userepository. Your help will be greatly appreciated.

\bigskip
\textit{Koppl, \DTMenglishmonthname{\DTMfetchmonth{compiled}} \DTMfetchyear{compiled}\\
Wolfgang Esser-Skala}

\cleardoublepage
\markdownInput{../CHANGELOG.md}

\cleardoublepage
\chapter*{Contents}

\InputIfFileExists{../tmp/lilypond.toc}{}{\InputIfFileExists{../lilypond.toc}{}{}}

\cleardoublepage
\fi

\iftemplate
\includepdf[pages=-]{../tmp/\lypdfname.pdf}
\fi

\end{document}
